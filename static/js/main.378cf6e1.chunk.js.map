{"version":3,"sources":["Editor.module.css","Help.module.css","DiagnosticsList.module.css","Disasm.module.css","asmBuiltins.ts","editing.ts","CloseButton.module.css","App.module.css","App.tsx","Editor.tsx","Disasm.tsx","DiagnosticsList.tsx","CloseButton.tsx","Help.tsx","index.tsx","../node_modules/import-fresh sync"],"names":["module","exports","heading","layoutContainer","editorContainer","textarea","textareaHighlightOverlay","textareaHighlightRow","textareaHighlightRowCurrent","highlightError","gutter","gutterRow","gutterRowSelected","helpModalContainer","helpContents","headingContainer","emph","hidden","circleReveal","circle","maxWidth","closeButtonContainer","asm","diagnostics","diagnosticsBox","diagItem","selected","error","disasmContainer","downloadButton","__webpack_require__","d","__webpack_exports__","c64","findCharOffset","source","loc","lines","split","offset","i","start","line","length","column","findLine","charOffset","buttonContainer","close","navContainer","appTitle","config","useWebWorkers","Emoji","props","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","aria-label","role","emoji","App","assemblerWorker","undefined","state","sourceCode","disassembly","prg","Buffer","from","diagnosticsIndex","helpVisible","handleWorkerMessage","e","data","_this2","setState","handleKeyDown","key","prevState","shiftKey","Math","max","min","preventDefault","handleOnClickDiagnostic","idx","debouncedCompile","fn","delay","timeoutID","_this","this","_len","arguments","args","Array","_key","clearTimeout","window","setTimeout","apply","debounce","asmArgs","postMessage","handleSetSource","text","sourceFileMap","main.asm","c64.asm","asmBuiltins","options","readFileSync","fname","Error","concat","res","assemble","errors","disasmOptions","isInstruction","debugInfo","info","disassemble","handleClearDiagnosticsSelectionOnKey","handleClearDiagnosticsSelectionOnMouse","handleClickHelp","handleCloseHelp","_this3","document","addEventListener","Worker","msg","diags","editorErrorLoc","id","className","styles","href","onClick","target","onKeyDown","onMouseDown","onMouseUp","_Editor__WEBPACK_IMPORTED_MODULE_9__","onSourceChanged","errorCharOffset","_Disasm__WEBPACK_IMPORTED_MODULE_10__","_DiagnosticsList__WEBPACK_IMPORTED_MODULE_11__","onClickItem","selectedIndex","_Help__WEBPACK_IMPORTED_MODULE_12__","visible","onClose","React","Component","tabLength","computeColumn","charIndex","col","ErrorSpans","lineLength","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","Symbol","iterator","next","done","value","err","buf","fill","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","end","x","rled","values","cur","out","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","v","push","code","count","groupSame","spans","span","react__WEBPACK_IMPORTED_MODULE_6___default","style","display","repeat","react__WEBPACK_IMPORTED_MODULE_6__","Highlighter","forwardRef","ref","rows","startRow","numRows","currentLine","lineToErrors","get","textLines","cn","Gutter","str","numStr","numTextRows","padStart","_default","Object","_Users_janne_dev_c64jasm_browser_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_Users_janne_dev_c64jasm_browser_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_janne_dev_c64jasm_browser_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","editorLineHeight","numEditorCharRows","textareaRef","createRef","gutterRef","highlighterRef","handleScroll","scrollTop","nativeEvent","handleSourceChanged","updateCursorState","current","r","selectionStart","selectionEnd","handleSelect","handleKeyUp","handleMouseDown","yoffs","offsetY","floor","cssVarLineHeight","getComputedStyle","documentElement","getPropertyValue","match","_wrapRegExp","height","exec","parseInt","groups","cssNumLines","indentTextarea","watch","spellcheck","focus","prevProps","setSelectionRange","vscroll","lineToErrorsMap","Map","forEach","_ref2","lst","has","set","startCharRow","textContainer","wrap","onKeyUp","onSelect","onScroll","onChange","DownloadButton","handleDownloadPRG","blob","Blob","FileSaver","saveAs","join","Diagnostic","itemRef","snapshot","scrollIntoView","behavior","block","_this$props$error","selectedClass","index","DiagnosticsList","handleOnClickItem","_this4","map","JSON","stringify","CloseButton","react_default","title","modalRoot","getElementById","Modal","classCallCheck","possibleConstructorReturn","getPrototypeOf","el","appendChild","removeChild","ReactDOM","createPortal","children","AsmBlock","s","trim","slice","trimLineFeeds","HelpContents","HelpModal","Help_Modal","Help_HelpContents","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","react_dom__WEBPACK_IMPORTED_MODULE_1__","react_dom__WEBPACK_IMPORTED_MODULE_1___default","_App__WEBPACK_IMPORTED_MODULE_3__","render","webpackEmptyContext","req","keys","resolve"],"mappings":"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","file":"static/js/main.378cf6e1.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"heading\":\"Editor_heading__3jsuC\",\"layoutContainer\":\"Editor_layoutContainer__2bFri\",\"editorContainer\":\"Editor_editorContainer__1wXnR\",\"textarea\":\"Editor_textarea__28EdL\",\"textareaHighlightOverlay\":\"Editor_textareaHighlightOverlay__1opTU\",\"textareaHighlightRow\":\"Editor_textareaHighlightRow__1R6Ia\",\"textareaHighlightRowCurrent\":\"Editor_textareaHighlightRowCurrent__25KL2\",\"highlightError\":\"Editor_highlightError__1YeA5\",\"gutter\":\"Editor_gutter__3CDcX\",\"gutterRow\":\"Editor_gutterRow__1DNMN\",\"gutterRowSelected\":\"Editor_gutterRowSelected__3GiGf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"helpModalContainer\":\"Help_helpModalContainer__10bLm\",\"helpContents\":\"Help_helpContents__3Cbr8\",\"headingContainer\":\"Help_headingContainer__jN87w\",\"emph\":\"Help_emph__29_7I\",\"hidden\":\"Help_hidden__2fGZK\",\"circleReveal\":\"Help_circleReveal__2igbG\",\"circle\":\"Help_circle__2jpkq\",\"maxWidth\":\"Help_maxWidth__3MUy2\",\"closeButtonContainer\":\"Help_closeButtonContainer__1TIMT\",\"asm\":\"Help_asm__1yYjY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"layoutContainer\":\"DiagnosticsList_layoutContainer__3Yxfa\",\"diagnostics\":\"DiagnosticsList_diagnostics__U_t5K\",\"heading\":\"DiagnosticsList_heading__f0lgX\",\"diagnosticsBox\":\"DiagnosticsList_diagnosticsBox__NbaZi\",\"diagItem\":\"DiagnosticsList_diagItem__3otDW\",\"selected\":\"DiagnosticsList_selected__jbDsD\",\"error\":\"DiagnosticsList_error__1cDSO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"heading\":\"Disasm_heading__2ZRjL\",\"layoutContainer\":\"Disasm_layoutContainer__36ehI\",\"disasmContainer\":\"Disasm_disasmContainer__2QplX\",\"downloadButton\":\"Disasm_downloadButton__3MkkT\"};","\nexport const c64 = `\n!filescope c64\n!macro basic_start(addr) {\n* = $801\n    !byte $0c, $08, $00, $00, $9e\n    !for d in [10000, 1000, 100, 10, 1] {\n        !if (addr >= d) {\n            !byte $30 + (addr/d)%10\n        }\n    }\n    !byte 0, 0, 0\n}\n`;\n","\nimport { SourceLoc } from 'c64jasm';\n\nexport function findCharOffset(source: string, loc: SourceLoc) {\n  const lines = source.split('\\n');\n  let offset = 0;\n  for (let i = 0; i < loc.start.line - 1; i++) {\n    offset += lines[i].length + 1;\n  }\n  return offset + loc.start.column - 1;\n}\n\nexport function findLine(source: string, charOffset: number) {\n  const lines = source.split('\\n');\n  let offset = 0;\n  for (let i = 0; i < lines.length; i++) {\n    offset += lines[i].length + 1;\n    if (charOffset < offset) {\n        return i;\n    }\n  }\n  return undefined;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonContainer\":\"CloseButton_buttonContainer__28ZWo\",\"close\":\"CloseButton_close__1cumB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navContainer\":\"App_navContainer__32B3M\",\"appTitle\":\"App_appTitle__2SEQk\"};","import React from 'react';\n\nimport { assemble, disassemble } from 'c64jasm';\n\nimport { Diag } from './types';\nimport * as asmBuiltins from './asmBuiltins';\nimport { findCharOffset }  from './editing';\n\nimport Editor from './Editor';\nimport Disasm from './Disasm';\nimport DiagnosticsList from './DiagnosticsList';\nimport Help from './Help';\n\nimport styles from './App.module.css';\n\nexport function debounce<F extends (...params: any[]) => void>(fn: F, delay: number) {\n  let timeoutID: number|undefined = undefined;\n  return function(this: any, ...args: any[]) {\n    clearTimeout(timeoutID);\n    timeoutID = window.setTimeout(() => fn.apply(this, args), delay);\n  } as F;\n}\n\nconst config = { useWebWorkers: true };\n\nfunction Emoji(props: {emoji: string}) {\n  return <span aria-label='emoji' role='img'>{props.emoji}</span>\n}\n\ninterface AppState {\n  sourceCode: string;\n  disassembly: string[];\n  prg: Buffer;\n  diagnosticsIndex: number | undefined;\n  diagnostics: Diag[];\n  helpVisible: boolean;\n};\n\nclass App extends React.Component<{}, AppState> {\n\n  assemblerWorker: Worker | undefined = undefined;\n\n  state = {\n    sourceCode: '',\n    disassembly: [],\n    prg: Buffer.from([]),\n    diagnosticsIndex: 0,\n    diagnostics: [],\n    helpVisible: false\n  }\n\n  componentDidMount () {\n    document.addEventListener('keydown', this.handleKeyDown);\n\n    this.assemblerWorker = new Worker('worker.js');\n    if (this.assemblerWorker !== null) {\n      this.assemblerWorker.addEventListener('message', (msg: MessageEvent) => {\n        this.handleWorkerMessage(msg);\n      });\n    }\n  }\n\n  handleWorkerMessage = (e: any) => {\n    if (e.data.diagnostics.length === 0) {\n      this.setState({\n        prg: e.data.prg,\n        disassembly: e.data.disassembly,\n        diagnostics: e.data.diagnostics,\n      });\n    } else {\n      this.setState({\n        diagnostics: e.data.diagnostics,\n      });\n    }\n  };\n\n  handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'F4') {\n      this.setState((prevState) => {\n        if (prevState.diagnostics.length === 0) {\n          return { diagnosticsIndex: 0 };\n        }\n        if (prevState.diagnosticsIndex === undefined) {\n          return { diagnosticsIndex: 0 };\n        }\n        if (e.shiftKey) {\n          return {\n            diagnosticsIndex: Math.max(0, prevState.diagnosticsIndex - 1)\n          }\n        } else {\n          return {\n            diagnosticsIndex: Math.min(prevState.diagnostics.length - 1, prevState.diagnosticsIndex + 1)\n          }\n        }\n      })\n      e.preventDefault();\n    }\n    if (e.key === 'Escape') {\n      // Clear focus from diagnostics list and\n      // exit help if it happens to be visible.\n      this.setState({\n        diagnosticsIndex: undefined,\n        helpVisible: false\n      });\n      e.preventDefault();\n    }\n  }\n\n  handleOnClickDiagnostic = (idx: number) => {\n    this.setState({\n      diagnosticsIndex: idx\n    })\n  }\n\n  debouncedCompile = debounce((asmArgs: any) => {\n    if (config.useWebWorkers && this.assemblerWorker) {\n      this.assemblerWorker.postMessage(asmArgs);\n    }\n  }, 250);\n\n  handleSetSource = (text: string) => {\n    const sourceFileMap: {[ndx: string]: string} = {\n      \"main.asm\": text,\n      \"c64.asm\": asmBuiltins.c64\n    };\n\n    if (config.useWebWorkers && this.assemblerWorker) {\n      this.debouncedCompile({ sourceFileMap });\n      this.setState({\n        sourceCode: text,\n        diagnosticsIndex: undefined\n      })\n    } else {\n      const options = {\n        readFileSync: (fname: string) => {\n          if (fname in sourceFileMap) {\n            return sourceFileMap[fname];\n          }\n          throw new Error(`File not found ${fname}`);\n        }\n      }\n      const res = assemble(\"main.asm\", options);\n      if (res.errors.length === 0) {\n        const disasmOptions = {\n          isInstruction: res.debugInfo.info().isInstruction\n        };\n        this.setState({\n          sourceCode: text,\n          prg: res.prg,\n          disassembly: disassemble(res.prg, disasmOptions),\n          diagnostics: [],\n          diagnosticsIndex: undefined\n        });\n      } else {\n        this.setState({\n          sourceCode: text,\n          diagnostics: res.errors,\n          diagnosticsIndex: undefined\n        })\n      }\n    }\n  }\n\n  // If typing in the editor, clear any diagnostics selection\n  handleClearDiagnosticsSelectionOnKey = (e: React.KeyboardEvent) => {\n    if (e.key === 'F4' || e.key === 'Shift') {\n      return;\n    }\n    if (this.state.diagnosticsIndex !== undefined) {\n      this.setState({ diagnosticsIndex: undefined });\n    }\n  }\n\n  // If typing in the editor, clear any diagnostics selection\n  handleClearDiagnosticsSelectionOnMouse = (e: React.MouseEvent) => {\n    if (this.state.diagnosticsIndex !== undefined) {\n      this.setState({ diagnosticsIndex: undefined });\n    }\n  }\n\n  handleClickHelp = (e: React.MouseEvent) => {\n    e.preventDefault();\n    this.setState({ helpVisible: true });\n  }\n\n  handleCloseHelp = () => {\n    this.setState({ helpVisible: false });\n  }\n\n  render () {\n    const diags: Diag[] = this.state.diagnostics;\n    let editorErrorLoc = undefined;\n    if (diags.length !== 0 && this.state.diagnosticsIndex !== undefined) {\n      const d = diags[this.state.diagnosticsIndex];\n      editorErrorLoc = findCharOffset(this.state.sourceCode, d.loc);\n    }\n    return (\n      <div id='root'>\n        <nav id=\"mainNav\">\n          <div className={styles.navContainer}>\n            <div className={styles.appTitle}><a href='https://nurpax.github.io/c64jasm/'>c64jasm</a> online</div>\n            <p>A little experimental 6502 assembler for the C64</p>\n            <p><Emoji emoji='👉' /> <a onClick={this.handleClickHelp} href='/' target='_blank'>help</a></p>\n            <p><Emoji emoji='👉' /> <a href='https://github.com/nurpax/c64jasm-browser'>source code</a></p>\n          </div>\n        </nav>\n        <div\n          onKeyDown={this.handleClearDiagnosticsSelectionOnKey}\n          onMouseDown={this.handleClearDiagnosticsSelectionOnMouse}\n          onMouseUp={this.handleClearDiagnosticsSelectionOnMouse}\n          id=\"mainCode\"\n        >\n          <Editor\n            onSourceChanged={this.handleSetSource}\n            diagnostics={this.state.diagnostics}\n            errorCharOffset={editorErrorLoc}\n          />\n        </div>\n        <div id=\"siteDisasm\">\n          <Disasm disassembly={this.state.disassembly} prg={this.state.prg} />\n        </div>\n        <div id=\"mainDiag\">\n          <DiagnosticsList\n            onClickItem={this.handleOnClickDiagnostic}\n            diagnostics={this.state.diagnostics}\n            selectedIndex={this.state.diagnosticsIndex} />\n        </div>\n        <Help visible={this.state.helpVisible} onClose={this.handleCloseHelp} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","\nimport React, { Fragment } from 'react';\nimport indentTextarea from 'indent-textarea';\nimport cn from 'classnames';\n\nimport { findLine } from './editing';\nimport { SourceLoc } from 'c64jasm';\nimport styles from './Editor.module.css';\n\nconst tabLength = 4;\n\n// RLE compress a list of T's\nfunction groupSame<T>(values: T[]): { count: number, code: T }[] {\n  let cur = undefined;\n  let out = [];\n\n  for (let v of values) {\n      // Start new run\n      if (cur !== v) {\n          cur = v;\n          out.push({code: cur, count: 1});\n      } else {\n          // Keep growing current group\n          out[out.length-1].count++;\n      }\n  }\n  return out;\n}\n\n// Count the actual screen char column offset\n// based on a character index and the source code\n// line contents.\nfunction computeColumn(line: string, charIndex: number) {\n  let col = 0;\n  for (let i = 0; i < charIndex; i++) {\n    if (line.length < i) {\n      return undefined;\n    }\n    if (line[i] === '\\t') {\n      col += tabLength;\n    } else {\n      col++;\n    }\n  }\n  return col;\n}\n\n// This function can return null if it can't find the diagnostic\n// column from the source code.  This can happen if the\n// diagnostics are matched on a different version of diagnostics\n// vs. source code.  This can happen as the compiler\n// runs in a separate thread while text editing happens\n// in the main thread without syncing to compiler\n// results.\nfunction ErrorSpans(props: {\n  text: string,\n  errors: SourceLoc[]\n}) {\n  let lineLength = 0;\n  if (!props.text) {\n    return null;\n  }\n  for (let c of props.text) {\n    if (c === '\\t') {\n      lineLength += tabLength;\n    } else {\n      lineLength++;\n    }\n  }\n  const buf: boolean[] = Array(lineLength).fill(false);\n\n  for (const err of props.errors) {\n    const start = computeColumn(props.text, err.start.column - 1);\n    if (start === undefined) {\n      return null;\n    }\n    const end = err.start.line === err.end.line ? computeColumn(props.text, err.end.column - 1) : start + 1;\n    if (end === undefined) {\n      return null;\n    }\n    for (let x = start; x < end; x++) {\n      buf[x] = true;\n    }\n  }\n  const rled = groupSame(buf);\n  const spans = [];\n  for (let i = 0; i < rled.length; i++) {\n    const span = rled[i];\n    if (!span.code) {\n      spans.push(<pre key={i} style={{display: 'inline-block'}}>{' '.repeat(span.count)}</pre>);\n    } else {\n      spans.push(<pre key={i} style={{display: 'inline-block'}} className={styles.highlightError}>{' '.repeat(span.count)}</pre>);\n    }\n  }\n  return <Fragment>{spans}</Fragment>;\n}\n\ninterface HighlighterProps {\n  startRow: number;\n  numRows: number;\n  currentLine: number | undefined;\n  textLines: string[];\n  lineToErrors: Map<number, SourceLoc[]>;\n}\n\nconst Highlighter = React.forwardRef((props: HighlighterProps, ref: React.Ref<HTMLDivElement>) => {\n  const rows = [];\n  // Pad rows is required for smooth scrolling (so that there is overflow-y to scroll)\n  const padRows = 2;\n  for (let i = props.startRow; i < props.startRow + props.numRows + padRows; i++) {\n    const selected = i === props.currentLine && styles.textareaHighlightRowCurrent;\n    const errors = props.lineToErrors.get(i);\n    if (errors) {\n      const text = props.textLines[i];\n      rows.push(<div className={cn(styles.textareaHighlightRow, selected)} key={i}><ErrorSpans text={text} errors={errors} /></div>);\n    } else {\n      rows.push(<div className={cn(styles.textareaHighlightRow, selected)} key={i}></div>);\n    }\n  }\n  return (\n    <div ref={ref} className={styles.textareaHighlightOverlay}>\n      {rows}\n    </div>\n  );\n})\n\ninterface GutterProps {\n  startRow: number;\n  numRows: number;\n  numTextRows: number;\n  currentLine: number | undefined;\n}\n\nconst Gutter = React.forwardRef((props: GutterProps, ref: React.Ref<HTMLDivElement>) => {\n  const rows = [];\n  const padRows = 2;\n  for (let i = props.startRow; i < props.startRow + props.numRows + padRows; i++) {\n    const str = `${i+1}`;\n    const selected = i === props.currentLine && styles.gutterRowSelected;\n    const numStr = (i >= 0 && i < props.numTextRows) ? str.padStart(4, ' ') : '';\n    rows.push(<div className={cn(styles.gutterRow, selected)} key={i}>{numStr}</div>);\n  }\n  return (\n    <div ref={ref} className={styles.gutter}>\n      {rows}\n    </div>\n  );\n});\n\ninterface EditorProps {\n  onSourceChanged: (text: string) => void;\n  diagnostics: { loc: SourceLoc, msg: string }[];\n  errorCharOffset: number | undefined;\n}\n\ninterface EditorState {\n  scrollTop: number;\n  currentLine: number | undefined;\n  textLines: string[];\n}\n\nexport default class extends React.Component<EditorProps, EditorState> {\n\n  private editorLineHeight = 0;\n  private numEditorCharRows = 0;\n\n  constructor (props: EditorProps) {\n    super(props);\n\n    this.state = {\n      scrollTop: 0,\n      currentLine: undefined,\n      textLines: []\n    }\n\n    const cssVarLineHeight = getComputedStyle(document.documentElement).getPropertyValue('--code-window-line-height');\n    let match = /^[ ]*(?<height>[0-9]+)px$/.exec(cssVarLineHeight);\n    if (!match) {\n      throw new Error('failed querying css var --code-window-line-height' + cssVarLineHeight);\n    }\n    this.editorLineHeight = parseInt((match as any).groups.height);\n    const cssNumLines = getComputedStyle(document.documentElement).getPropertyValue('--code-window-num-lines');\n    match = /^[ ]*(?<lines>[0-9]+)$/.exec(cssNumLines);\n    if (!match) {\n      throw new Error('failed querying css var --code-window-num-lines');\n    }\n    this.numEditorCharRows = parseInt((match as any).groups.lines);\n  }\n\n  textareaRef = React.createRef<HTMLTextAreaElement>();\n  gutterRef = React.createRef<HTMLDivElement>();\n  highlighterRef = React.createRef<HTMLDivElement>();\n\n  handleScroll = (e: React.UIEvent<HTMLTextAreaElement>) => {\n    const { scrollTop } = e.nativeEvent.target as any;\n    this.setState({ scrollTop })\n  }\n\n  handleSourceChanged = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    this.props.onSourceChanged(e.target.value);\n    this.setState({\n      textLines: e.target.value.split('\\n')\n    })\n  }\n\n  updateCursorState = () => {\n    if (this.textareaRef && this.textareaRef.current) {\n      const r = this.textareaRef.current;\n      if (r.selectionStart === r.selectionEnd) {\n        const loc = r.selectionStart;\n        const line = findLine(this.textareaRef.current.value, loc);\n        this.setState({ currentLine: line });\n      } else {\n        this.setState({ currentLine: undefined });\n      }\n    }\n  }\n\n  // Update cursor position when keys are pressed or selection changes on mouse click\n  handleSelect = (e: React.SyntheticEvent<HTMLTextAreaElement>) => {\n    this.updateCursorState();\n  }\n  handleKeyDown = (e: React.KeyboardEvent) => {\n    this.updateCursorState();\n  }\n  handleKeyUp = (e: React.KeyboardEvent) => {\n    this.updateCursorState();\n  }\n\n  componentDidMount () {\n    if (this.textareaRef && this.textareaRef.current) {\n      indentTextarea.watch(this.textareaRef.current);\n      this.textareaRef.current.spellcheck = false;\n      this.textareaRef.current.focus();\n    }\n  }\n\n  componentDidUpdate (prevProps: EditorProps, prevState: EditorState) {\n    if (this.textareaRef && this.textareaRef.current) {\n      if (this.props.errorCharOffset !== undefined) {\n        this.textareaRef.current.focus();\n        this.textareaRef.current.setSelectionRange(this.props.errorCharOffset, this.props.errorCharOffset);\n      }\n    }\n\n    if (prevState.scrollTop !== this.state.scrollTop) {\n      const scrollTop = this.state.scrollTop;\n      const vscroll = scrollTop % this.editorLineHeight;\n      if (this.gutterRef && this.gutterRef.current) {\n        this.gutterRef.current.scrollTop = vscroll;\n      }\n      if (this.highlighterRef && this.highlighterRef.current) {\n        this.highlighterRef.current.scrollTop = vscroll;\n      }\n    }\n  }\n\n  handleMouseDown = (e: React.MouseEvent) => {\n    if (this.textareaRef && this.textareaRef.current) {\n      const yoffs = e.nativeEvent.offsetY + this.state.scrollTop;\n      this.setState({\n        currentLine: Math.min(this.state.textLines.length - 1, Math.floor(yoffs / this.editorLineHeight))\n      });\n    }\n  }\n\n  render () {\n    const lineToErrorsMap = new Map<number, SourceLoc[]>();\n    this.props.diagnostics.forEach(({loc}) => {\n      const line = loc.start.line - 1;\n      const lst = lineToErrorsMap.has(line) ? lineToErrorsMap.get(line)! : [];\n      lst.push(loc);\n      lineToErrorsMap.set(line, lst);\n    })\n    const startCharRow = Math.floor(this.state.scrollTop / this.editorLineHeight);\n    return (\n      <div className={styles.layoutContainer}>\n        <div className={styles.heading}>Assembly</div>\n        <div className={styles.editorContainer}>\n          <Gutter\n            ref={this.gutterRef}\n            startRow={startCharRow}\n            numRows={this.numEditorCharRows}\n            numTextRows={this.state.textLines.length}\n            currentLine={this.state.currentLine}\n          />\n          <div className={styles.textContainer} onMouseDown={this.handleMouseDown}>\n            <Highlighter\n              ref={this.highlighterRef}\n              startRow={startCharRow}\n              numRows={this.numEditorCharRows}\n              currentLine={this.state.currentLine}\n              textLines={this.state.textLines}\n              lineToErrors={lineToErrorsMap}\n            />\n            <textarea\n              wrap='off'\n              onKeyUp={this.handleKeyUp}\n              onKeyDown={this.handleKeyDown}\n              onSelect={this.handleSelect}\n              onScroll={this.handleScroll}\n              ref={this.textareaRef}\n              onChange={this.handleSourceChanged} className={styles.textarea}></textarea>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","\nimport React from 'react';\nimport FileSaver from 'file-saver';\nimport styles from './Disasm.module.css';\n\nfunction DownloadButton(props: { onClick: (e: React.MouseEvent) => void}) {\n  return (\n    <div>\n      <a\n        onClick={props.onClick}\n        className={styles.downloadButton}\n        href='/' target='_blank'>\n          Download .PRG\n      </a>\n    </div>\n  )\n}\ninterface DisasmProps {\n  disassembly: string[];\n  prg: Buffer;\n}\n\nexport default class extends React.Component<DisasmProps> {\n  handleDownloadPRG = (e: React.MouseEvent) => {\n    e.preventDefault();\n    const blob = new Blob([this.props.prg]);\n    FileSaver.saveAs(blob, \"c64jasm-online.prg\");\n  }\n\n\n  render () {\n    return (\n      <div className={styles.layoutContainer}>\n        <div className={styles.heading}>\n          <div>Disassembly</div>\n          <DownloadButton onClick={this.handleDownloadPRG} />\n        </div>\n        <div className={styles.disasmContainer}>\n            <pre>{this.props.disassembly.join('\\n')}</pre>\n        </div>\n      </div>\n    )\n  }\n}\n","\nimport React from 'react'\n\nimport { SourceLoc } from 'c64jasm';\n\nimport { Diag } from './types'\n\nimport styles from './DiagnosticsList.module.css'\n\ninterface DiagnosticProps {\n  error: { loc: SourceLoc, msg: string };\n  index: number;\n  selected: boolean;\n  onClickItem: (idx: number) => void;\n}\n\nclass Diagnostic extends React.Component<DiagnosticProps> {\n  itemRef = React.createRef<HTMLDivElement>();\n\n  componentDidUpdate (prevProps: DiagnosticProps, prevState: {}, snapshot: DiagnosticProps) {\n    if (this.itemRef && this.itemRef.current && this.props.selected) {\n      this.itemRef.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center'\n      })\n    }\n  }\n\n  render() {\n    const { loc, msg } = this.props.error;\n    const selectedClass = this.props.selected ? ` ${styles.selected}` : '';\n    return (\n      <div\n        ref={this.itemRef}\n        className={`${styles.diagItem}${selectedClass}`}\n        onClick={() => this.props.onClickItem(this.props.index)}\n      >\n        <span className={`${styles.error}${selectedClass}`}>main.asm:{loc.start.line}:{loc.start.column}: error:</span> {msg}\n      </div>\n    )\n  }\n}\n\ninterface DiagnosticsListProps {\n  diagnostics: Diag[];\n  selectedIndex: number | undefined;\n  onClickItem: (idx: number) => void;\n}\n\nexport default class DiagnosticsList extends React.Component<DiagnosticsListProps> {\n  handleOnClickItem = (idx: number) => {\n    this.props.onClickItem(idx);\n  }\n\n  render() {\n    const diags = this.props.diagnostics;\n    return (\n      <div className={styles.layoutContainer}>\n        <div className={styles.heading}>Diagnostics</div>\n        <div className={styles.diagnostics}>\n          <div className={styles.diagnosticsBox}>\n            {diags.map((d: Diag, idx) => {\n              return (\n                <Diagnostic\n                  key={JSON.stringify(d.loc)}\n                  index={idx}\n                  error={d} selected={idx === this.props.selectedIndex}\n                  onClickItem={this.handleOnClickItem}\n                />\n              )\n            })}\n          </div>\n        </div>\n      </div>\n    )\n  }\n}","import React from 'react';\n\nimport styles from './CloseButton.module.css';\n\nexport default function CloseButton(props: { onClose: () => void}) {\n  return (\n    <div className={styles.buttonContainer}>\n      <a title='Close Help' href='/' target='_blank' className={styles.close} onClick={e => {\n          e.preventDefault();\n          props.onClose();\n        }}>\n      </a>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cn from 'classnames';\n\nimport CloseButton from './CloseButton'\nimport styles from './Help.module.css';\nimport * as asmBuiltins from './asmBuiltins';\n\nconst modalRoot = document.getElementById('modal-root')!;\n\ninterface ModalProps {\n  children: JSX.Element;\n}\n\nclass Modal extends React.Component {\n  private el: HTMLDivElement;\n\n  constructor(props: ModalProps) {\n    super(props);\n    this.el = document.createElement('div');\n  }\n\n  componentDidMount() {\n    // The portal element is inserted in the DOM tree after\n    // the Modal's children are mounted, meaning that children\n    // will be mounted on a detached DOM node. If a child\n    // component requires to be attached to the DOM tree\n    // immediately when mounted, for example to measure a\n    // DOM node, or uses 'autoFocus' in a descendant, add\n    // state to Modal and only render the children when Modal\n    // is inserted in the DOM tree.\n    modalRoot.appendChild(this.el);\n  }\n\n  componentWillUnmount() {\n    modalRoot.removeChild(this.el);\n  }\n\n  render() {\n    return ReactDOM.createPortal(\n      this.props.children,\n      this.el,\n    );\n  }\n}\n\n// Remove leading and trailing line feeds from a string.\n// This is to prevent unnecessary line feeds in\n// assembly code written in string literals.\nfunction trimLineFeeds(str: string): string {\n  const lines = str.split('\\n');\n  let s;\n  for (s = 0; s < lines.length; s++) {\n    const line = lines[s].trim();\n    if (line.length !== 0) {\n      break;\n    }\n  }\n  let e;\n  for (e = lines.length - 1; e >= 0; e--) {\n    const line = lines[e].trim();\n    if (line.length !== 0) {\n      break;\n    }\n  }\n  return lines.slice(s, e + 1).join('\\n');\n}\n\nfunction AsmBlock(props: { text: string }) {\n  return (\n    <pre className={styles.asm}>{trimLineFeeds(props.text)}</pre>\n  )\n}\nclass HelpContents extends React.Component<{onClose: () => void}> {\n  render () {\n    return (\n      <div className={cn(styles.helpContents, styles.maxWidth)}>\n        <div className={styles.headingContainer}>\n          <div className={styles.closeButtonContainer}>\n            <CloseButton onClose={this.props.onClose} />\n          </div>\n          <h1>c64jasm online </h1>\n        </div>\n        <p>\n          <a href='https://nurpax.github.io/c64jasm/'>c64jasm</a> is a 6502 assembler written in JavaScript.\n          You can run it either on the command line using Node or link it into a web app.\n        </p>\n        <p>\n          <a href='https://nurpax.github.io/c64jasm-browser/'>c64jasm online</a> is an interactive assembler demo site\n          where you can write 6502 assembly with live error reporting and disassembly.\n        </p>\n\n        <h3>Examples</h3>\n\n        <p>Simple instructions and expressions:</p>\n        <AsmBlock text={`\n    lda #2+2  ; expression in an immediate field\n    sta $d020 ; set border color\n        `} />\n\n        <p>Labels:</p>\n        <AsmBlock text={`\nentry: {\n    jsr func\n\n    ldx #8\nloop: ; label local to 'entry' scope\n    dex\n    bpl loop\n}\n\nfunc: {\n    ldx #7\nloop: ; label local to 'func' scope\n    sta buf, x   ; store to buf\n    dex\n    bpl loop\n    rts\n\nbuf: !fill 8, 0    ; 8 byte array\n}\n        `} />\n\n        <p>Declaring and using variables:</p>\n        <AsmBlock text={`\n!let num_sprites = 4\n!let sprite_mask = (1<<num_sprites)-1\n\n    lda #sprite_mask\n    sta $d015 ; enable sprites 0-3\n        `} />\n\n        <p>Conditional compilation and repetition:</p>\n        <AsmBlock text={`\n!let num_sprites = 4\n    lda #13  ; ptr to sprite data 1 (==address/64)\n    ldx #14  ; ptr to sprite data 2\n\n!for i in range(num_sprites) {\n    !if (i < 2) {\n        sta $07f8+i   ; sprite data 1 from A\n    } else {\n        stx $07f8+i   ; sprite data 2 from X\n    }\n}\n        `} />\n\n        <p>Define and use macro macro:</p>\n        <AsmBlock text={`\n!macro set_border(color) {\n    lda #color\n    sta $d020\n}\n\n+set_border(13)  ; expand\n        `} />\n\n        <p>A complete C64 program.  To compile a C64 <code>.prg</code> you need\n        to insert a BASIC startup sequence at the beginning of your output <code>.prg</code> --\n        you can use the <code>c64::basic_entry</code> macro to do this.\n        The source code to these macros is shown in a later section.\n        </p>\n\n        <AsmBlock text={`\n!include \"c64.asm\"\n\n+c64::basic_start(entry)\n\nentry: {\n    lda #0\n}\n        `} />\n\n        <h3>Built-in support macros</h3>\n\n        <p>The c64jasm online site includes a small built in macro library.  You can find its source code below.</p>\n\n        <p>The builtin <code>c64.asm</code> contents:</p>\n        <AsmBlock text={asmBuiltins.c64} />\n\n      </div>\n    )\n  }\n}\n\ninterface HelpProps {\n  visible: boolean;\n  onClose: () => void;\n}\n\nclass HelpModal extends React.Component<HelpProps> {\n  render () {\n    const { visible } = this.props;\n    return (\n      <Modal>\n        <div className={cn(visible ? styles.helpModalContainer : styles.hidden)}>\n          <div className={styles.circleReveal}>\n            <HelpContents onClose={this.props.onClose}/>\n          </div>\n        </div>\n      </Modal>\n    )\n  }\n}\n\nexport default HelpModal;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('viewport_root'));\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 61;"],"sourceRoot":""}